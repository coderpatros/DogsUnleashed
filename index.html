<html>
<head>
    <meta charset=utf-8 />
    <title>Dogs Unleashed</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/esri-leaflet@2.0.4"></script>

    <style>
        body { margin:0; padding:0; }

        #disclaimer {
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 0;
            width:100%;
            height:100%;
            text-align:center;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.75);
        }

        #disclaimer div {
            width: 300px;
            margin: 50px auto;
            background-color: #fff;
            border: 1px solid #000;
            padding: 15px;
            text-align:center;
        }

        #map { position: absolute; top:0; bottom:0; right:0; left:0; }
    </style>
</head>
<body>

<div id="map"></div>

<div id="disclaimer">
    <div>
        <h1>Dogs Unleashed</h1>
        <p>This was an idea that came out of the Sunshine Coast Council HackFest 2015.</p>
        <p>Designated off leash areas may change. Ensure you check current signage at the location.</p>
        <p><a href='#' onclick='disclaimerToggle()'>Continue</a></p>
    </div>
</div>

<script>
    function disclaimerToggle() {
        el = document.getElementById("disclaimer");
        el.style.visibility = (el.style.visibility == "visible") ? "hidden" : "visible";
    }

    var map = L.map('map').setView([ -26.653127, 153.067969 ], 11);

    L.esri.basemapLayer('Streets').addTo(map);

    var offLeashStyles = {
        "Dogs prohibited at all times": {
            color: "#ff0000"
        },
        "Dogs off leash at all times": {
            color: "#009933"
        },
        "Dogs off leash at times indicated on signs": {
            color: "#ffff00"
        },
        "Dogs off leash 4pm to 8am": {
            color: "#ffff00"
        },
        "Dogs off leash 5am to 8am and 5pm to 8pm": {
            color: "#ffff00"
        },
        "Dogs off leash May to October, 4pm to 8am": {
            color: "#ffff00"
        },
        "Pedestrian Thoroughfare - dogs on leash at all times": {
            color: "#ff6600"
        },
        "Spectators with dogs on leash at all times allowed": {
            color: "#ff6600"
        }
    };

    var $legendItemContainer = $("#legendItemContainer");
    $.each(offLeashStyles, function(name, styles) {
        var $legendItem = $("<li></li>");
        $legendItem.data("item", name);
        $legendItem.text(name);
        if (styles.color) $legendItem.css("border-color", styles.color);
        if (styles.fillColor) $legendItem.css("background-color", styles.fillColor);
        if (styles.fillOpacity) $legendItem.css("background-transparency", styles.fillOpacity);
        $legendItem.appendTo($legendItemContainer);
    });

    var offLeashAreas = L.esri.featureLayer({
        url: 'https://gisservices.scc.qld.gov.au/arcgis/rest/services/Boundaries/Boundaries_SCRC/MapServer/6',
        style: function (feature) {
            var style = {
                color: "#000000",
                fillOpacity: 0.5,
                weight: 2
            };

            var additionalStyles = offLeashStyles[feature.properties.Times_1] || {};
            for (var styleName in additionalStyles) {
                if (additionalStyles.hasOwnProperty(styleName)) {
                    style[styleName] = additionalStyles[styleName];
                }
            }

            style.fillColor = style.color;
            return style;
        }
    });
    offLeashAreas.addTo(map);
    offLeashAreas.bindPopup(function (evt) {
        return L.Util.template('<p>{Times_1}<br>{Location}</p>', evt.feature.properties);
    });

    var waterFittingIcons = {
        "Tap": "https://gisservices.scc.qld.gov.au/arcgis/rest/services/Structure/Structure_SCRC/MapServer/1/images/cf5de1c1b612b850ed6802c92276653c",
        "Drinking Fountain": "https://gisservices.scc.qld.gov.au/arcgis/rest/services/Structure/Structure_SCRC/MapServer/1/images/e1096fb69dc81ce747553178ddd272f5",
        "Dog Bowl": "https://gisservices.scc.qld.gov.au/arcgis/rest/services/Structure/Structure_SCRC/MapServer/1/images/b859de9190ff66de02e473ecfeaa0d34"
    };

    var waterFittings = L.esri.featureLayer({
        url: 'https://gisservices.scc.qld.gov.au/arcgis/rest/services/Structure/Structure_SCRC/MapServer/1',
        pointToLayer: function (geojson, latlng) {
            return L.marker(latlng, {
                icon: L.icon({
                    iconUrl: waterFittingIcons[geojson.properties.AssetSubType],
                    iconSize: [18, 18],
                    iconAnchor: [9, 9],
                    popupAnchor: [0, -11]
                })
            });
        }
    });
    waterFittings.setWhere("AssetSubType='Dog Bowl'");
    waterFittings.addTo(map);
    waterFittings.bindPopup(function (evt) {
        return L.Util.template('<p>{AssetSubType}<br>{LocationDesc}</p>', evt.feature.properties);
    });

    disclaimerToggle();
</script>

</body>
</html>